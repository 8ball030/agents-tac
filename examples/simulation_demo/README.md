# simulation_demo

This tutorial shows how to simulate a simple TAC.

## Demo

- Ensure that you are running an OEF Node on `localhost`. 

- Run the simulation example:

      python examples/simulation_demo/tac_agent_spawner.py

- Run the simulation example with the gui flag to visualize data in realtime

      python examples/simulation_demo/tac_agent_spawner.py --gui  

and then open `http://localhost:8097` in your browser.

### Optional parameters

- `--nb-agents` is the number of agents to participate in the competition.
- `--nb-goods` is the number of goods in the competition.
- `--nb-baseline-agents` is the number of number of baseline agents to participate in the competition.
- `--oef-addr` and `--oef-port` allow you to specify a different OEF Node to use for the simulation.
- `--uml` specifies whether or not to store the activity of the simulation in PlantUML syntax.
- `--data-output-dir` is the output directory to use for storing simulation data in `${data_output_dir}/${experiment_id}`.
- `--experiment-id` is the name to give to the simulation.
- `--plot` specifies whether to plot a summary of the game.
- `--lower-bound-factor` is the lower bound factor of a uniform distribution used for generating good instances.
- `--upper-bound-factor` is the upper bound factor of a uniform distribution used for generating good instances.
- `--fee` is the transaction fee.
- `--registration-timeout` is the amount of time (in seconds) to wait for agents to register before attempting to start the competition.
- `--inactivity-timeout` is the amount of time (in seconds) to wait during inactivity until the termination of the competition.
- `--competition-timeout` is the amount of time (in seconds) to wait from the start of the competition until the termination of the competition.
- `--seed` is the seed for the random module.

### Optional flags
- `--gui` is a flag to specify that the gui is live and expecting an event stream.

Example:

      python examples/simulation_demo/tac_agent_spawner.py 
          --nb-agents 10
          --nb-goods 10
          --nb-baseline-agents 10
          --oef-addr oef.economicagents.com 
          --oef-port 3333
          --uml True
          --data-output-dir data
          --experiment-id my_experiment
          --plot True
          --lower-bound-factor 1
          --upper-bound-factor 1
          --fee 1
          --registration-timeout 10
          --inactivity-timeout 20
          --competition-timeout 120
          --seed 42
      
It generates a `game.json` file in the `${data_output_dir}/${experiment_id}` that can be inspected with a GUI (see `tac/gui`).

### Display UML transition diagram

In order to visualize the UML transition diagram generated by the simulation (if the option `--uml True` has been used), 
you can do the following:

- build the `docker-tac-develop` image:

      ./docker-tac-develop/scripts/docker-build-img.sh
      
- run the image:

      ./docker-tac-develop/scripts/docker-run.sh -- /bin/bash
      
- use the following command:

      python3 -m plantuml `${data_output_dir}/${experiment_id}/diagram.uml`
      
  the output will be printed in the file `diagram.png`.
