# simulation_demo

This tutorial shows how to simulate a simple TAC.

## Demo

- Be sure you're running an OEF Node on `localhost`. 

- Run the simulation example:

      python examples/simulation_demo/tac_agent_spawner.py 
          --nb-agents 10
          --nb-goods 10
          --nb-baseline-agents 10

    
This follows the sequence diagram of the communications between agents:


### Optional parameters

- `--oef-addr` and `--oef-port` allow you to specify a different OEF Node to use for the simulation.
- `--uml-out` is the filepath where to store the activity of the simulation in PlantUML syntax.
- `--data-output-dir` is the output directory to use for storing simulation data.
- `--experiment-id` is the name to give to the simulation. The data will be stored in `${data_output_dir}/${experiment_id}`.

Example:

      python examples/simulation_demo/tac_agent_spawner.py 
          --nb-agents 10
          --nb-goods 10
          --nb-baseline-agents 10
          --oef-addr oef.economicagents.com 
          --oef-port 3333
          --uml-out out.uml
          --data-output-dir my_data
          --experiment-id my_experiment
      
It generates a `game.json` file in `my_data/my_experiment/` folder that looks like:

```
{'fee': 1,
 'initial_endowments': [[1, 0, 2, 2, 2], [1, 2, 0, 0, 0]],
 'initial_money_amount': 20,
 'instances_per_good': 2,
 'nb_agents': 2,
 'nb_goods': 5,
 'preferences': [[4, 0, 1, 3, 2], [3, 4, 2, 0, 1]],
 'scores': [4, 3, 2, 1, 0],
 'transactions': [{'amount': 3,
                   'buyer_id': 1,
                   'good_ids': [0, 1, 2, 3, 4],
                   'quantities': [0, 0, 1, 1, 1],
                   'seller_id': 0,
                   'timestamp': '2019-04-03 15:25:25.240885'},
                  {'amount': 3,
                   'buyer_id': 0,
                   'good_ids': [0, 1, 2, 3, 4],
                   'quantities': [0, 1, 0, 0, 0],
                   'seller_id': 1,
                   'timestamp': '2019-04-03 15:25:25.242052'}]}
```

### Display UML transition diagram

In order to visualize the UML transition diagram generated by the simulation (if the option `--uml-out` has been used), 
you can do the following:

- build the `docker-tac-develop` image:

      ./docker-tac-develop/scripts/docker-build-img.sh
      
- run the image:

      ./docker-tac-develop/scripts/docker-run.sh -- /bin/bash
      
- use the following command (assuming that the transition diagram file is called `out.uml`):

      python3 -m plantuml out.uml
      
  the output will be printed in the file `out.png`.
